<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>卡關檢測互動</title>
  <style>
    :root {
      /* 品牌暖色系配色：以橘紅為主色，搭配暖黃為輔色，營造溫馨、高級感。 */
      --primary-color: #d0502a;     /*主色：深橘紅，用於按鈕、標題*/
      --primary-light: #dd6726;     /*次色：暖橘色，用於按鈕 hover、次要按鈕*/
      --primary-dark: #9a3a22;      /*加深色：重點文字*/
      --accent-color: #efa93b;      /*輔助色：金黃色，用於點綴、標題底線*/
      --background-color: #fff9f0;  /*背景：淡杏色，營造柔和溫暖的基調*/
      --card-background: #ffffff;   /*卡片背景：純白，對比主色*/
      --text-color: #333333;        /*文字顏色：深灰，提高閱讀性*/
      /* 新增選項配色，使互動按鈕背景更柔和 */
      --option-bg: #fff3e8;
      --option-hover-bg: #ffe5d4;
      --option-selected-bg: #ffe9d5;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
      margin: 0;
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* 首頁標語樣式 */
    .tagline {
      font-size: 1rem;
      font-weight: 600;
      /* 主標語使用主色增強辨識度 */
      color: var(--primary-color);
      margin: 0.6rem auto 0.3rem;
      max-width: 600px;
    }
    .tagline-sub {
      font-size: 0.95rem;
      /* 副標語使用輔助色呼應核心理念 */
      color: var(--primary-light);
      margin: 0.2rem auto 0.8rem;
      max-width: 600px;
    }
    .intro-call {
      font-size: 0.95rem;
      color: var(--primary-dark);
      margin-bottom: 1rem;
    }
    .container {
      width: 95%;
      max-width: 740px;
      background: var(--card-background);
      border-radius: 16px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.05);
      padding: 2.4rem 2rem;
      box-sizing: border-box;
      text-align: center;
      margin: 1rem auto;
    }

    h2, h3 {
      margin-top: 0;
    }

    #intro h2 {
      color: var(--primary-dark);
    }

    button, .option {
      display: block;
      width: 100%;
      margin: 0.8rem 0;
      padding: 0.9rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      /* 按鈕仍使用主色；選項按鈕的顏色在下方單獨覆蓋 */
      background-color: var(--primary-color);
      color: #fff;
      cursor: pointer;
      transition: background-color 0.25s ease, transform 0.15s ease;
    }

    /* 選項按鈕單獨定義：使用更柔和的背景，以提高可讀性 */
    .option {
      background-color: var(--option-bg);
      color: var(--primary-dark);
      border: 1px solid var(--primary-light);
    }
    .option:hover {
      background-color: var(--option-hover-bg);
      color: var(--primary-dark);
    }

    /* 調整一般按鈕與選項 hover 效果，使顏色不至於太重 */
    button:hover {
      background-color: var(--primary-light);
      color: #fff;
    }
    .option:hover {
      background-color: var(--option-hover-bg);
      color: var(--primary-dark);
    }

    .option.selected {
      /* 選項被點選後的顏色：使用柔和的選中背景色，讓文字更易閱讀 */
      background-color: var(--option-selected-bg);
      color: var(--primary-dark);
      border-color: var(--primary-light);
      transform: scale(1.03);
    }

    .hidden {
      display: none;
    }

    .feedback {
      margin-top: 0.5rem;
      font-size: 0.95rem;
      color: var(--primary-dark);
      font-weight: 500;
    }

    /* 結果卡片 */
    .result-title {
      font-size: 1.6rem;
      color: var(--primary-dark);
      margin-bottom: 0.5rem;
    }

    .result-description {
      margin-bottom: 1rem;
      line-height: 1.5;
      font-size: 1rem;
      white-space: pre-line;
    }

    .cta {
      margin-top: 1.8rem;
      font-size: 1rem;
      color: var(--primary-dark);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #1f1f1f;
        --card-background: #2a2a2a;
        --text-color: #eaeaea;
      }
    }

    /* 響應式字體與間距，讓小螢幕也易於閱讀 */
    @media (max-width: 600px) {
      .container {
        padding: 1.6rem 1.2rem;
      }
      h2 {
        font-size: 1.4rem;
      }
      h3 {
        font-size: 1.2rem;
      }
      button,
      .option {
        padding: 0.8rem 1rem;
        font-size: 0.9rem;
      }
      .result-title {
        font-size: 1.4rem;
      }
      .result-description {
        font-size: 0.95rem;
      }
      .next-btn,
      .download-btn,
      .consult-btn {
        font-size: 0.85rem;
        padding: 0.7rem 1rem;
      }
    }

    /* 新增按鈕樣式 */
    .next-btn, .download-btn, .consult-btn {
      display: inline-block;
      margin: 1rem 0.5rem;
      padding: 0.8rem 1.2rem;
      font-size: 0.9rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .next-btn {
      /* 使用輔助色作為下一題按鈕底色，文字色採重點深色 */
      background-color: var(--accent-color);
      color: var(--primary-dark);
    }

    .download-btn {
      /* 下載按鈕使用輔助色，使顏色更柔和、清晰 */
      background-color: var(--accent-color);
      color: var(--primary-dark);
    }

    .consult-btn {
      /* 活潑的諮詢按鈕：使用輔助色，文字為深色，並略加大尺寸 */
      background-color: var(--accent-color);
      color: var(--primary-dark);
      text-decoration: none;
      padding: 0.9rem 1.6rem;
      font-weight: 600;
      border-radius: 8px;
    }

    .next-btn:hover {
      /* Hover 時改用主色，文字變白以提升對比 */
      background-color: var(--primary-color);
      color: #fff;
    }

    .download-btn:hover {
      background-color: var(--primary-dark);
      color: #fff;
    }

    .consult-btn:hover {
      background-color: var(--primary-color);
      color: #fff;
      transform: scale(1.05);
    }

    
    /* 模組化資源卡片樣式 */
    .resource-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    .resource-card {
      flex: 1 1 calc(33% - 1rem);
      background-color: var(--option-bg);
      border: 1px solid var(--accent-color);
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      padding: 1rem;
      text-align: center;
      min-width: 200px;
      /* 保留 3D 效果以支援翻牌動畫 */
      transform-style: preserve-3d;
      /* 新增動畫過渡效果，滑鼠移入時放大並提升陰影 */
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    .resource-card h4 {
      margin-top: 0.4rem;
      font-size: 1rem;
      color: var(--primary-color);
    }
    .resource-card p {
      font-size: 0.9rem;
      color: var(--primary-dark);
      margin-top: 0.3rem;
    }
/* 針對下載按鈕與重新開始按鈕重新定義底色，提高可讀性 */
    #download-btn {
      background-color: var(--primary-light);
      color: var(--primary-dark);
    }
    #download-btn:hover {
      background-color: var(--primary-color);
      color: #fff;
    }
    #restart-btn {
      background-color: var(--accent-color);
      color: var(--primary-dark);
    }
    #restart-btn:hover {
      background-color: var(--primary-dark);
      color: #fff;
    }

    /* 提示框樣式：在問題上方顯示回饋，採用輕柔底色與細邊框 */
    #hint-box {
      display: none;
      padding: 0.8rem 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      background-color: #fff5ec;
      border: 1px solid var(--accent-color);
      color: var(--primary-dark);
      font-size: 0.95rem;
      line-height: 1.4;
    }

    /* 載入動畫：能量圓圈擴散效果 */
    #loading {
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 245, 236, 0.95);
      z-index: 9999;
      color: var(--primary-dark);
      text-align: center;
    }
    #loading .loading-text {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 1.2rem;
    }
    #loading .circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--primary-light);
      position: relative;
      overflow: hidden;
    }
    #loading .circle::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      /* 使用漸層背景，呈現能量由中心向外擴散 */
      background: radial-gradient(circle, var(--accent-color) 0%, rgba(239,169,59,0) 70%);
      /* 加快能量圓圈的呼吸節奏：將動畫時間由 2s 調整為 1s，使擴散收縮更為活潑 */
      animation: pulse 1s infinite ease-in-out;
    }
    @keyframes pulse {
      /* 能量圓圈呼吸動態：更明顯的伸縮變化 */
      0% {
        transform: scale(0.5);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.7);
        opacity: 0.3;
      }
      100% {
        transform: scale(0.5);
        opacity: 0.8;
      }
    }

    /* 結果頁附加區域樣式 */
    #consultation-info, #skool-info {
      margin: 1.5rem 0;
      text-align: center;
    }
    #consultation-info p, #skool-info p, #skool-info ul {
      margin: 0.6rem 0;
      line-height: 1.5;
      font-size: 0.95rem;
      color: var(--primary-dark);
    }
    #consultation-info strong {
      font-weight: bold;
    }
    #skool-info ul {
      list-style-type: disc;
      padding-left: 1.2rem;
      text-align: left;
      display: inline-block;
    }
    #skool-info ul li {
      margin: 0.4rem 0;
    }

    /* 下載說明與諮詢區塊：與其他區塊保持一致的間距與文字樣式 */
    #download-info, #consultation-section {
      margin: 1.5rem 0;
      text-align: center;
    }
    #download-info p, #consultation-section p {
      margin: 0.6rem 0;
      line-height: 1.5;
      font-size: 0.95rem;
      color: var(--primary-dark);
    }

    /* 諮詢清單樣式 */
    .consult-list {
      list-style-type: disc;
      margin: 0.6rem auto;
      padding-left: 1.2rem;
      max-width: 640px;
      text-align: left;
      color: var(--primary-dark);
    }
    .consult-list li {
      margin: 0.3rem 0;
      font-size: 0.9rem;
    }

    /* 自訂清單項目的符號顏色，讓標記呼應品牌色 */
    .consult-list li::marker {
      color: var(--accent-color);
    }
    #skool-info ul li::marker {
      color: var(--accent-color);
    }

    /* 結果區域各模組背景設定：分段呈現，區隔資訊對象 */
    #download-info, #consultation-section, #skool-info {
      background-color: #fff5ec;
      border: 1px solid #ffdccc;
      border-radius: 12px;
      padding: 1.4rem 1.2rem;
      margin: 1.6rem auto;
      max-width: 680px;
      box-sizing: border-box;
    }

    /* 故事敘述區內文置中顯示，增進閱讀性 */
    #story-box p {
      margin: 0.6rem 0;
      text-align: center;
      line-height: 1.6;
      white-space: pre-line;
    }
    .join-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.8rem 1.4rem;
      border-radius: 8px;
      /* Skool 加入按鈕使用輔助色並置中顯示，呈現活潑感 */
      background-color: var(--accent-color);
      color: var(--primary-dark);
      text-decoration: none;
      font-size: 1rem;
      transition: background-color 0.2s ease, transform 0.15s ease;
    }
    .join-btn:hover {
      background-color: var(--primary-color);
      color: #fff;
      transform: scale(1.05);
    }

    /* 首頁介紹列表樣式 */
    #intro ul.intro-list {
      list-style-type: disc;
      margin: 1rem auto;
      padding-left: 1.2rem;
      text-align: left;
      max-width: 600px;
    }
    #intro ul.intro-list li {
      margin: 0.4rem 0;
      font-size: 0.95rem;
      color: var(--primary-dark);
    }

    /* 結果卡片樣式 */
    .result-card {
      /* 使用淺色背景與邊框使結果報告與背景區隔，並增大內邊距給予安全空間 */
      background-color: #fff5ec;
      border: 1px solid #ffdccc;
      border-radius: 16px;
      padding: 2rem 1.6rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
      margin: 1.6rem auto;
      position: relative;
      max-width: 680px;
    }
    .result-header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background-color: var(--accent-color);
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
    }

    /* 進度條樣式 */
    .progress {
      width: 100%;
      height: 8px;
      background-color: #e5e5e5;
      border-radius: 4px;
      margin-bottom: 1rem;
      overflow: hidden;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    /* 進度點樣式：顯示每一題的位置 */
    .progress-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 0.8rem;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #e5e5e5;
      margin: 0 4px;
      transition: background-color 0.3s ease;
    }
    .dot.active {
      background-color: var(--accent-color);
    }

    /* 轉換動畫容器：前後對比圖交替顯示 */
    .trans-animation {
      position: relative;
      width: 100%;
      max-width: 320px;
      height: 200px;
      margin: 1rem auto;
      overflow: hidden;
    }
    .trans-animation img {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      object-fit: contain;
      opacity: 0;
    }
    .trans-animation img.before {
      animation: fadeOutIn 8s infinite;
    }
    .trans-animation img.after {
      animation: fadeInOut 8s infinite;
    }
    @keyframes fadeOutIn {
      0% { opacity: 1; }
      45% { opacity: 1; }
      50% { opacity: 0; }
      95% { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes fadeInOut {
      0% { opacity: 0; }
      45% { opacity: 0; }
      50% { opacity: 1; }
      95% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* 動畫效果 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    .fade-in {
      animation: fadeIn 0.5s forwards;
    }
    .fade-out {
      animation: fadeOut 0.4s forwards;
    }

    /* 進度標籤樣式：顯示當前題數/總題數 */
    .progress-label {
      font-size: 0.9rem;
      color: var(--primary-dark);
      margin-top: 0.3rem;
      margin-bottom: 0.8rem;
      text-align: center;
    }

    /* 資源卡片 hover 效果：放大並增加陰影 */
    .resource-card:hover {
      /* 鼠標滑入資源卡時，微微翻轉並放大，增加互動感 */
      transform: translateY(-6px) scale(1.1) rotateY(7deg);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    /* Hero 圖片 hover 效果 */
    .hero-image img {
      transition: transform 0.4s ease;
    }
    .hero-image:hover img {
      transform: scale(1.05);
    }

    /* 結果圖 hover 效果 */
    .result-image-container img {
      /* 調整結果圖片尺寸為自動高度並完整呈現，不裁切 */
      transition: transform 0.3s ease;
      width: 100%;
      height: auto;
      max-height: 320px;
      object-fit: contain;
      display: block;
    }
    .result-image-container:hover img {
      transform: scale(1.05);
    }

    /* CTA 高亮區塊 */
    .cta-highlight {
      background-color: #fff3e8;
      border: 1px solid #ffdccc;
      border-radius: 14px;
      padding: 1.2rem;
      margin-top: 1.6rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: left;
    }
    .cta-highlight h4 {
      margin: 0 0 0.6rem;
      color: var(--primary-color);
      font-size: 1.05rem;
      font-weight: 600;
    }
    .cta-highlight ul {
      list-style: none;
      padding-left: 0;
      margin: 0.6rem 0 1rem;
    }
    .cta-highlight ul li {
      display: flex;
      align-items: flex-start;
      margin: 0.4rem 0;
      font-size: 0.9rem;
      color: var(--primary-dark);
    }
    .cta-highlight ul li span {
      margin-right: 0.6rem;
      font-size: 1.4rem; /* 放大表情符號，使 CTA 列表更吸睛 */
    }
    .cta-highlight ul li {
      font-size: 1rem; /* 提高 CTA 內文字體大小，強調亮點 */
    }
    .cta-highlight p {
      font-size: 0.95rem; /* 調整 CTA 內段落字體 */
    }
    .cta-highlight .special-cta {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.9rem 1.8rem;
      border-radius: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      /* 使用漸層背景讓 CTA 更顯眼 */
      background-image: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .cta-highlight .special-cta:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    /* CTA 區域橫向排列：左側為文字與按鈕，右側為轉變示意圖 */
    .cta-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1.2rem;
    }
    .cta-content {
      flex: 1 1 55%;
    }
    .cta-image {
      flex: 1 1 40%;
      display: flex;
      justify-content: center;
    }
    .cta-image .trans-animation {
      width: 100%;
      max-width: 300px;
      height: 200px;
    }
  </style>
</head>
<body>
  <div class="container">
      <!-- 載入覆蓋層，用於生成結果時的過場動畫 -->
      <div id="loading">
        <div class="loading-text">生成專屬報告中...</div>
        <div class="circle"></div>
      </div>
    <!-- 首頁介紹 -->
    <div id="intro">
      <!-- Hero 區域：標題、副標、敘述與行動號召 -->
      <div class="hero-section" style="padding:2.4rem 0 1.6rem;">
        <h1 class="hero-title" style="font-size:2rem;margin-bottom:0.4rem;color:var(--primary-dark);font-weight:700;">BeBetter&nbsp;卡關檢測</h1>
        <h2 class="hero-subtitle" style="font-size:1.4rem;color:var(--primary-color);font-weight:600;margin-top:0;margin-bottom:0.8rem;">2 分鐘找到你的減脂卡關點</h2>
        <p class="hero-desc" style="font-size:1rem;color:var(--primary-dark);max-width:640px;margin:0 auto 1.2rem;line-height:1.6;">
          減脂不是知識的問題，而是行為的瓶頸。<br>在這裡，你會找到突破卡關的方法。
        </p>
        <!-- 可以自行替換的 Hero 圖片：採用高質感邊框與柔和陰影作為留白，若無圖片可保留此框架 -->
        <div class="hero-image" style="max-width:720px;margin:0 auto 1.4rem;border:1px solid #ffdccc;border-radius:14px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,0.05);background-color:#fff5ec;">
          <!-- 預設圖片留白區，使用者可替換為健康意象圖；為避免干擾主標題，保持適中高度 -->
          <!-- 使用新上傳的問卷測驗圖片作為首頁 Hero 圖案 -->
          <img src="assets/images/問卷測驗.png" alt="BeBetter hero image" style="width:100%;height:260px;object-fit:cover;display:block;">
        </div>
        <button id="start-btn" class="hero-btn" style="background-color:var(--primary-color);color:#fff;padding:0.9rem 1.8rem;border:none;border-radius:10px;font-size:1rem;cursor:pointer;transition:background-color 0.25s ease;">
          立即開始檢測
        </button>
      </div>
    </div>
    <!-- 問題區域 -->
    <div id="question-area" class="hidden">
      <!-- 提示框 -->
      <div id="hint-box"></div>
      <!-- 進度條 -->
      <div id="progress" class="progress hidden">
        <div id="progress-inner"></div>
      </div>
      <!-- 顯示目前題數 / 總題數的標籤 -->
      <div id="progress-label" class="progress-label hidden"></div>
      <!-- 顯示進度點的容器，依題數生成小圓點 -->
      <div id="progress-dots" class="progress-dots hidden"></div>
      <h3 id="question"></h3>
      <div id="options"></div>
      <div id="feedback" class="feedback hidden"></div>
      <div id="next-container" class="hidden">
        <button id="next-btn" class="next-btn">下一題</button>
      </div>
    </div>
    <!-- 結果顯示區域 -->
    <div id="result-area" class="hidden">
      <!-- 使用者故事敘述區：根據選擇自動生成，置於結果最上方 -->
      <div id="story-box" class="hidden" style="background-color:#fff5ec;border:1px solid #ffdccc;border-radius:12px;padding:1.4rem 1.2rem;margin:1.6rem auto;max-width:680px;box-sizing:border-box;text-align:center;"></div>
      <!-- 結果卡片：顯示主分類、描述與心理分析 -->
      <div class="result-card">
        <div class="result-header"></div>
      <!-- 結果圖片區：顯示對應主分類的插圖 -->
      <div class="result-image-container" style="width:100%;margin:1rem auto 1.4rem;border:1px solid #ffdccc;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <!-- 使用 object-fit: contain 讓圖片完整呈現比例，避免被裁切。 -->
        <!-- 將容器高度自適應，設定最大高度，保持圖片完整顯示 -->
        <img id="result-image" src="" alt="結果類型圖片" style="width:100%;height:auto;max-height:350px;object-fit:contain;">
      </div>
        <div class="result-title" id="result-title"></div>
        <div class="result-description" id="result-description"></div>
        <div class="result-description" id="result-analysis"></div>
        <div class="result-description" id="result-reassure"></div>
      </div>
      <!-- 說明下載結果卡的區塊 -->
      <div id="download-info">
        <p><strong>為什麼要下載結果卡？</strong></p>
        <p>這張專屬結果卡詳細紀錄你的選擇與心理分析，它是你減脂旅程的一個節點，讓你隨時提醒自己從哪裡出發、走過哪些困難。</p>
        <button id="download-btn" class="download-btn">下載結果卡</button>
      </div>
      <!-- 說明一對一諮詢的重要性 -->
      <div id="consultation-section">
        <p><strong>為什麼要來一對一諮詢？</strong></p>
        <p>如果你願意為了自己開始改變，現在就可以預約我們的一對一營養顧問諮詢。專業營養師會協助你找到真正的動機與明確的目標。</p>
        <p>這是減脂過程最重要的事情，因為有了目標才能知道往哪裡走；有了動機，才有力量在困難時繼續前進，那個目標，就是你心中的北極星。</p>
        <p>這場諮詢非常寶貴，全程線上進行，採一對一服務，每一位諮詢都是收費的專業服務——<strong>但現在你可以免費預約一次</strong>。</p>
        <a id="consult-link" class="consult-btn" href="https://243112.typeform.com/to/skpdVy" target="_blank" rel="noopener noreferrer">立即預約諮詢</a>
      </div>
      <!-- Skool 介紹區 -->
      <div id="skool-info">
        <p><strong>現在加入 Skool，一起改變</strong></p>
        <p>我們的 3C 減脂法專為總是復胖或沒時間的上班族打造，幫你找到適合自己的瘦身節奏，不再靠意志力硬撐，也能健康瘦下來。</p>
        <ul>
          <li>✅ 28 天看到成果，90 天培養不復胖體質</li>
          <li>✅ 每週 1 任務循序漸進：先做到 → 再搞懂 → 做出結果</li>
          <li>✅ 營養師陪跑＋直播答疑，沒有人再孤軍奮戰</li>
          <li>✅ 3,000+ 位真實見證，真正做到「不再反彈」</li>
        </ul>
        <p><strong>完整資源包含：</strong></p>
        <div class="resource-grid">
          <div class="resource-card">
            <div style="font-size:1.6rem;">📘</div>
            <h4>3C 減脂法課程架構</h4>
            <p>用對節奏，讓身體開始改變</p>
          </div>
          <div class="resource-card">
            <div style="font-size:1.6rem;">🍱</div>
            <h4>外食 / 居家搭配清單</h4>
            <p>7-11 也能吃得健康瘦</p>
          </div>
          <div class="resource-card">
            <div style="font-size:1.6rem;">🎬</div>
            <h4>30+ 跟做影片</h4>
            <p>有人陪你一步步完成</p>
          </div>
          <div class="resource-card">
            <div style="font-size:1.6rem;">🎓</div>
            <h4>營養師群答疑＋專家直播</h4>
            <p>你不再一個人</p>
          </div>
          <div class="resource-card">
            <div style="font-size:1.6rem;">📝</div>
            <h4>每週任務打卡機制</h4>
            <p>幫你走完 12 週，不再放棄</p>
          </div>
          <div class="resource-card">
            <div style="font-size:1.6rem;">🏆</div>
            <h4>成果驗收＋等級制度</h4>
            <p>看到變化、感受自信</p>
          </div>
        </div>
        <!-- CTA 高亮呈現區塊 -->
        <div class="cta-highlight">
          <h4>🧡 最重要的是：</h4>
          <!-- 使用 flex 排版：左側顯示課程特點與 CTA，右側顯示前後變化動畫 -->
          <div class="cta-row">
            <div class="cta-content">
              <ul>
                <li><span>🔥</span>每週只做一件事，不會痛苦</li>
                <li><span>🌱</span>不需要馬上改變全部習慣，新手也能入門</li>
                <li><span>💰</span>月費只要 $4（美金），比一餐還便宜</li>
              </ul>
              <p style="margin:0.6rem 0 1rem;">加入就能獲得這些價值超過 NT$29,980 的資源。</p>
              <a href="https://www.skool.com/bebetter/about?ref=70c9688e53ea4c4a9612b7e4be2bf17c" target="_blank" rel="noopener noreferrer" class="special-cta">用一個便當的費用開始改變</a>
            </div>
            <div class="cta-image">
              <!-- 轉變示意圖：前後對比，使用交替動畫呈現課程帶來的改變 -->
              <div class="trans-animation">
                <img class="before" src="assets/images/Gemini_Generated_Image_ufereluferelufer.png" alt="before transformation">
                <img class="after" src="assets/images/Gemini_Generated_Image_t8pftat8pftat8pf.png" alt="after transformation">
              </div>
            </div>
          </div>
        </div>
      </div>
      <button id="restart-btn" class="next-btn" style="margin-top: 2rem;">重新開始</button>
    </div>
  </div>

  <script>
    // 問題與選項定義
    // 定義問卷問題：改為固定順序的多題測驗，讓用戶能回答更多面向（共 7 題）
    const questions = {
      Q1: {
        text: '最近讓你最困擾的是什麼？',
        options: [
          { id: 'A', text: '我很難控制飲食量（外食/聚餐太多）' },
          { id: 'B', text: '我常常紀錄幾天就斷掉，覺得麻煩' },
          { id: 'C', text: '我運動不穩定，中斷後很難再恢復' },
          { id: 'D', text: '我在聚餐或社交場合很容易失控' },
          { id: 'E', text: '我的體重卡住不動，讓我很焦慮' },
        ]
      },
      Q2: {
        text: '當你「失控」時，你通常會怎麼想？',
        options: [
          { id: 'slip', text: '反正都壞了，乾脆繼續放縱' },
          { id: 'broken', text: '一旦中斷，就覺得自己失敗，乾脆放棄' },
          { id: 'delay', text: '告訴自己「之後再補」，但常常沒有之後' },
          { id: 'compensate', text: '我會立刻補救（隔天少吃/多運動）' },
        ]
      },
      Q3: {
        text: '運動方面，你覺得最貼近的是？',
        options: [
          { id: 'allOrNothing', text: '如果不能完整運動，就乾脆不做' },
          { id: 'schedule', text: '常常計劃好，但一忙就完全沒動' },
          { id: 'restart', text: '有做過一陣子，但一斷掉就很難回來' },
        ]
      },
      Q4: {
        text: '聚餐之後，你通常的心情是？',
        options: [
          { id: 'disaster', text: '很罪惡，覺得努力全毀' },
          { id: 'loseControl', text: '告訴自己「沒關係」，但很難拉回來' },
          { id: 'accept', text: '我能接受，這是生活的一部分' },
        ]
      },
      Q5: {
        text: '當體重停住時，你的第一反應是？',
        options: [
          { id: 'worthless', text: '「是不是我沒用了？」' },
          { id: 'giveUp', text: '「再努力也沒用」' },
          { id: 'understand', text: '「體重沒掉，但腰圍或體態還在變」' },
        ]
      },
      Q6: {
        text: '你認為自己在減脂過程中最大的挑戰是什麼？',
        options: [
          { id: 'lackPersistence', text: '缺乏恆心，常半途而廢' },
          { id: 'socialTemptation', text: '抗拒不了社交/聚餐誘惑' },
          { id: 'tooBusy', text: '太忙沒有時間計畫' },
          { id: 'lackGuidance', text: '缺乏專業指導，不知道怎麼做' },
        ]
      },
      Q7: {
        text: '你對自己的睡眠品質評分如何？',
        options: [
          { id: 'poorSleep', text: '經常睡眠不足或睡不好' },
          { id: 'averageSleep', text: '偶爾睡不好，但還可以' },
          { id: 'goodSleep', text: '睡眠良好，精神飽滿' },
        ]
      }
      ,
      // 新增題目：每日飲水量
      Q8: {
        text: '你每天平均飲水量大約多少？',
        options: [
          { id: 'waterLow', text: '不足 1 公升' },
          { id: 'waterModerate', text: '1–1.5 公升' },
          { id: 'waterGood', text: '1.5–2 公升' },
          { id: 'waterHigh', text: '超過 2 公升' },
        ]
      },
      // 新增題目：情緒障礙
      Q9: {
        text: '你覺得在減脂過程中，最大的情緒障礙是什麼？',
        options: [
          { id: 'anxiety', text: '容易焦慮' },
          { id: 'frustration', text: '容易沮喪' },
          { id: 'lackMotivation', text: '缺乏動機' },
          { id: 'lackSupport', text: '沒有朋友支持' },
        ]
      }
    };

    // 問題順序列表
    // 將題目擴充到 9 題，提供更完整的評估體驗
    const questionOrder = ['Q1','Q2','Q3','Q4','Q5','Q6','Q7','Q8','Q9'];

    // 主分類對應文字
    const mainResults = {
      A: {
        title: '熱量控制不住型',
        description: '你是一位美食探索者，外食或聚餐時容易失守，因為你重視生活與人際的連結。',
      },
      B: {
        title: '飲食紀錄斷掉型',
        description: '你是個追求完美的人，對紀錄有很高標準，一旦斷掉就感到沮喪。',
      },
      C: {
        title: '運動不持續型',
        description: '你是一位忙碌的行動家，運動習慣常被行程打亂，這代表你對生活有多元的追求。',
      },
      D: {
        title: '社交影響型',
        description: '你重視人際關係，在聚餐或社交場合容易熱情過頭，事後會感到內疚。',
      },
      E: {
        title: '體重停滯焦慮型',
        description: '你非常在乎成果，一旦體重停住便容易焦慮，覺得自己的努力被否定。',
      },
    };

    // 對應每個主類型的圖片路徑，用於結果頁顯示及下載卡片
    // 對應每個主類型的圖片路徑，用於結果頁顯示及下載卡片。
    // 使用相對路徑指向 assets 資料夾，這樣部署到 GitHub Pages 時能正確載入。
    const resultImages = {
      A: 'assets/images/熱量控制不住型.png',
      B: 'assets/images/飲食紀錄斷掉型.png',
      C: 'assets/images/運動不持續型.png',
      D: 'assets/images/社交影響型.png',
      E: 'assets/images/體重停滯焦慮型.png'
    };

    // 心理偏差對應句子
    const psycheSentences = {
      slip: '你有時會因為一次失誤就乾脆放縱，這是正常的心理反應，顯示你對快樂的追求。',
      broken: '你對於紀錄擁有很高標準，導致一旦出現漏洞就覺得全盤失敗。這反映了你對完美的追求。',
      delay: '你會告訴自己之後再調整，但常常因為生活忙碌而拖延，這代表需要更簡單的步驟。',
      compensate: '你願意透過隔天少吃或多運動來補救失控，這顯示出你對健康的自我負責。',
      allOrNothing: '你對運動抱持著全有全無的心態，覺得做不到最好就乾脆不做。',
      schedule: '你的生活節奏很快，常讓計劃受阻。學會調整計劃能讓你更輕鬆。',
      restart: '你曾經有運動習慣，但停下來之後很難再開始，其實只需要從短時間恢復。',
      disaster: '你把聚餐視為災難，容易給自己過大的壓力。學會享受並平衡將有幫助。',
      loseControl: '你告訴自己沒關係，卻常常無法及時拉回，代表你需要更多支持。',
      accept: '你能接受聚餐是生活的一部分，這是一種健康的心態。',
      worthless: '你容易將體重與自我價值連結，這會影響你的信心。',
      giveUp: '你覺得再努力也不會有變化，這是平台期時的常見迷思。',
      understand: '你理解平台期是正常現象，並能從其他指標看到進步。',
      // 以下為延伸題目心理標籤解析
      // 飲水習慣
      waterLow: '你的飲水量偏低，建議增加飲水量以促進新陳代謝與飽足感。',
      waterModerate: '你的飲水量中等，偶爾留意補充能讓你身體機能更好。',
      waterGood: '你有良好的飲水習慣，能幫助體內代謝與控制食慾。',
      waterHigh: '你的飲水量充足，這對於維持新陳代謝與健康非常有益。',
      // 情緒障礙
      anxiety: '你容易感到焦慮，這可能與對成果的期待或對未知的擔憂有關。',
      frustration: '你容易沮喪，可能因為未如預期的進展而感到挫折。',
      lackMotivation: '你覺得缺乏動機，提示你需要找到更強烈的目標與支持。',
      lackSupport: '你感覺缺乏朋友的支持，社群陪伴能給你更多力量。'
    };

    // 故事敘述對應句子：將用戶的選擇轉換成個人化敘述，用於結果頁顯示
    const storySentences = {
      // 主分類敘述
      A: '你是一位美食探索者，喜歡外食與聚會，飲食控制成為你最大的課題。',
      B: '你追求完美，當紀錄沒有完全做到時就容易自責。',
      C: '你忙碌的生活讓運動變得困難，運動習慣常常中斷。',
      D: '你熱愛社交，在聚餐場合容易失控，但又充滿罪惡感。',
      E: '你非常在乎體重的數字，當數字停滯時感到焦慮。',
      // 心理反應敘述
      slip: '當你失控時，你容易有破罐子破摔的念頭。',
      broken: '你對紀錄要求完美，覺得一旦斷掉就前功盡棄。',
      delay: '你常說之後再補救，但現實總是來不及。',
      compensate: '你願意透過補償來調整，顯示你對健康的自我負責。',
      // 運動相關
      allOrNothing: '你對運動有全有全無的想法，不夠完美乾脆不做。',
      schedule: '你的行程滿檔，常常打亂運動計劃。',
      restart: '你運動過，但很難在中斷後再次開始。',
      // 聚餐相關
      disaster: '聚餐對你而言像災難，總讓你充滿負罪感。',
      loseControl: '你常告訴自己沒關係，但後續控制變得困難。',
      accept: '你接受聚餐是生活的一部分，懂得平衡享受與控制。',
      // 體重停滯相關
      worthless: '當體重停滯你懷疑自己的價值與努力。',
      giveUp: '你覺得再努力也沒用，容易動搖你的信心。',
      understand: '你知道平台期是過程的一部分，能從其他指標看到進步。',
      // 新增題目敘述
      lackPersistence: '你認為自己缺乏恆心，希望能維持習慣。',
      socialTemptation: '你難以抗拒社交誘惑，需要策略來平衡。',
      tooBusy: '你工作忙碌，想尋找簡單有效的減脂方式。',
      lackGuidance: '你渴望得到專業指導，讓你知道接下來該怎麼做。',
      poorSleep: '你時常睡不好，這影響了你的身心狀態。',
      averageSleep: '你的睡眠偶爾受影響，提醒你注意休息。',
      goodSleep: '你睡眠充足，擁有良好的身心基礎。',
      // 飲水習慣敘述
      waterLow: '你飲水量偏低，需要多喝水保持代謝與飽足感。',
      waterModerate: '你的飲水量中等，適度補充可增進健康。',
      waterGood: '你有良好的飲水習慣，這有助於新陳代謝。',
      waterHigh: '你的飲水量充足，為健康提供良好基礎。',
      // 情緒障礙敘述
      anxiety: '你有焦慮傾向，需要找到減壓方法與信任自己。',
      frustration: '你容易沮喪，需學習正向看待暫停或挫折。',
      lackMotivation: '你缺乏動機，需要找到令你熱血的目標。',
      lackSupport: '你覺得缺乏支持，需要社群鼓勵與陪伴。'
    };

    // 根據用戶的主類型與各選項標籤生成個性化敘述故事
    function generateStory() {
      const storyBoxEl = document.getElementById('story-box');
      if (!storyBoxEl) return;
      const sentences = [];
      // 主類型敘述
      if (storySentences[mainType]) {
        sentences.push(storySentences[mainType]);
      }
      // 其他標籤敘述
      tags.forEach(tag => {
        if (storySentences[tag]) {
          sentences.push(storySentences[tag]);
        }
      });
      if (sentences.length > 0) {
        // 避免重複句子
        const uniqueSentences = sentences.filter((item, index) => sentences.indexOf(item) === index);
        // 將句子串接成段落
        let combined = uniqueSentences.join(' ');
        // 在中文標點後插入換行符號，提升閱讀性
        combined = addLineBreaks(combined);
        storyBoxEl.innerHTML = '<p><strong>你的故事</strong></p><p>' + combined + '</p>';
        storyBoxEl.classList.remove('hidden');
      } else {
        storyBoxEl.classList.add('hidden');
      }
    }

    // 在中文句號或問號後插入換行符號
    function addLineBreaks(text) {
      if (!text) return '';
      // 將句號、問號後面加入換行符號
      return text
        // 將句號後的空白一起替換為換行
        .replace(/。\s*/g, '。\n')
        .replace(/？\s*/g, '？\n');
    }

    // 提示文字
    const feedbackPhrases = {
      A: '很多人都有類似的困擾，不用擔心。',
      B: '紀錄中斷很正常，等等會告訴你怎麼調整心態。',
      C: '運動習慣需要時間培養，我們一起找到適合你的方式。',
      D: '社交與聚餐是生活的一部分，找到平衡是關鍵。',
      E: '體重卡住是減脂過程的一環，耐心是關鍵。'
    };

let currentQuestion = null;
let currentIndex = 0;
let mainType = null;
let tags = [];
// 儲存使用者選擇的文字內容，供故事或結果卡片使用
let selectedTexts = [];

    // 進度點元素：顯示每一題位置的小圓點
    const progressDots = document.getElementById('progress-dots');

    // (已移除) 除錯與錯誤提示代碼，確保生產環境不顯示彈窗

    // 進度條相關變數：用於計算與顯示進度
    let stepCounter = 0;
    let totalSteps = 0;

    const intro = document.getElementById('intro');
    const questionArea = document.getElementById('question-area');
    const resultArea = document.getElementById('result-area');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    // 顯示提示文字的框
    const hintBox = document.getElementById('hint-box');
    const nextContainer = document.getElementById('next-container');
    const nextBtn = document.getElementById('next-btn');
    const downloadBtn = document.getElementById('download-btn');

    // 進度條元素
    const progress = document.getElementById('progress');
    const progressInner = document.getElementById('progress-inner');
    // 進度標籤，用於顯示當前題數 / 總題數
    const progressLabel = document.getElementById('progress-label');

    // 啟動測驗
    document.getElementById('start-btn').addEventListener('click', () => {
      intro.classList.add('hidden');
      questionArea.classList.remove('hidden');
      // 顯示進度條與進度標籤並重置
      progress.classList.remove('hidden');
      progressLabel.classList.remove('hidden');
      stepCounter = 0;
      totalSteps = 0;
      progressInner.style.width = '0%';
      progressLabel.textContent = '';
      startQuiz();
    });

    // 重新開始
    document.getElementById('restart-btn').addEventListener('click', () => {
      resultArea.classList.add('hidden');
      intro.classList.remove('hidden');
      mainType = null;
      tags = [];
      // 隱藏進度條與標籤
      progress.classList.add('hidden');
      progressLabel.classList.add('hidden');
      if (progressDots) {
        progressDots.classList.add('hidden');
      }
    });

    function startQuiz() {
      // 重置變數
      currentIndex = 0;
      currentQuestion = questionOrder[currentIndex];
      mainType = null;
      tags = [];
      selectedTexts = [];
      // 隱藏故事區域
      const storyBoxEl = document.getElementById('story-box');
      if (storyBoxEl) storyBoxEl.classList.add('hidden');
      // 設定總步驟數
      totalSteps = questionOrder.length;
      stepCounter = 0;
      progressInner.style.width = '0%';
      renderQuestion();
      // 生成進度點並顯示容器
      if (progressDots) {
        createProgressDots();
        progressDots.classList.remove('hidden');
      }
      // 顯示進度條與進度標籤
      if (progress) {
        progress.classList.remove('hidden');
      }
      if (progressLabel) {
        progressLabel.classList.remove('hidden');
      }
    }

    function renderQuestion() {
      const q = questions[currentQuestion];
      questionEl.textContent = q.text;
      optionsEl.innerHTML = '';
      feedbackEl.classList.add('hidden');
      hintBox.style.display = 'none';
      nextContainer.classList.add('hidden');
      nextBtn.onclick = null;
      q.options.forEach((opt) => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.textContent = opt.text;
        btn.addEventListener('click', () => handleAnswer(btn, opt.id));
        optionsEl.appendChild(btn);
      });
      // 問題淡入效果
      questionArea.classList.add('fade-in');
      setTimeout(() => questionArea.classList.remove('fade-in'), 500);
    }

    function handleAnswer(buttonEl, optionId) {
      // 第一題：設定主分類並顯示提示
      if (currentIndex === 0) {
        mainType = optionId;
        hintBox.textContent = feedbackPhrases[optionId];
        hintBox.style.display = 'block';
      }
      // 記錄標籤
      tags.push(optionId);
      // 記錄選項文字（用於故事及結果卡）
      const qObj = questions[currentQuestion];
      const textObj = qObj.options.find(o => o.id === optionId);
      if (textObj) selectedTexts.push(textObj.text);
      // 高亮所選項
      Array.from(optionsEl.children).forEach((btn) => btn.classList.remove('selected'));
      buttonEl.classList.add('selected');
      // 更新進度
      stepCounter = currentIndex + 1;
      updateProgress();
      // 判斷是否還有下一題
      const hasNext = currentIndex < questionOrder.length - 1;
      showNextButton(hasNext);
    }

    function showNextButton(hasNext) {
      // 顯示下一題或查看結果按鈕，並設定文字
      setTimeout(() => {
        nextBtn.textContent = hasNext ? '下一題' : '查看結果';
        nextContainer.classList.remove('hidden');
        // 移除舊事件，重新綁定
        nextBtn.onclick = null;
        nextBtn.onclick = () => {
          nextContainer.classList.add('hidden');
          if (hasNext) {
            currentIndex += 1;
            currentQuestion = questionOrder[currentIndex];
            hintBox.style.display = 'none';
            renderQuestion();
          } else {
            showLoadingAndResult();
          }
        };
      }, 150);
    }

    function showResult() {
      questionArea.classList.add('hidden');
      resultArea.classList.remove('hidden');
      // 進度條填滿並隱藏標籤
      stepCounter = totalSteps;
      updateProgress();
      if (progressLabel) {
        progressLabel.classList.add('hidden');
      }
      // 組合結果
      const result = mainResults[mainType];
      document.getElementById('result-title').textContent = result.title;
      // 描述
      document.getElementById('result-description').textContent = addLineBreaks(result.description);
      // 心理分析文字
      let analysis = '';
      tags.forEach((tag) => {
        if (psycheSentences[tag]) {
          analysis += psycheSentences[tag] + ' ';
        }
      });
      analysis = analysis.trim();
      document.getElementById('result-analysis').textContent = addLineBreaks(analysis);
      // 安撫文字
      let reassure = '';
      if (mainType === 'A') {
        reassure = '這不是失敗，而是非常普遍的困難。你對生活很有熱情，只需學習一些平衡的方法。';
      } else if (mainType === 'B') {
        reassure = '你其實很在乎結果，只是紀錄方式需要調整。小步連續比完美更重要。';
      } else if (mainType === 'C') {
        reassure = '不需要一開始就完美，任何時間的運動都是進步。';
      } else if (mainType === 'D') {
        reassure = '社交是生活的一部分，一次聚餐不會毀掉你的努力，重要的是態度。';
      } else if (mainType === 'E') {
        reassure = '平台期是正常現象，你還有很多其他方面在進步，請給自己時間。';
      }
      document.getElementById('result-reassure').textContent = addLineBreaks(reassure);
      // 結果顯示完成後可執行其他操作

      // 隱藏進度點容器，因為測驗已完成
      if (progressDots) {
        progressDots.classList.add('hidden');
      }

      // 設定結果圖片
      const resultImgEl = document.getElementById('result-image');
      if (resultImgEl && resultImages[mainType]) {
        resultImgEl.src = resultImages[mainType];
      }
      // 根據主類型調整結果卡片色調，例如 B 類型使用更柔和的標頭顏色
      const headerEl = document.querySelector('.result-header');
      if (headerEl) {
        if (mainType === 'B') {
          // 將標頭底色調淡，避免過於鮮豔，並採用更柔和的橙色
          headerEl.style.backgroundColor = 'rgba(239, 169, 59, 0.25)';
        } else {
          // 其他類型恢復為預設輔助色
          const rootStyles = getComputedStyle(document.documentElement);
          const accentClr = rootStyles.getPropertyValue('--accent-color');
          headerEl.style.backgroundColor = accentClr.trim();
        }
      }
      // 生成並顯示使用者故事
      generateStory();
    }

    // 顯示載入覆蓋層並於短暫延遲後顯示結果
    function showLoadingAndResult() {
      const loading = document.getElementById('loading');
      // 顯示覆蓋層，並關閉問題區域
      loading.style.display = 'flex';
      questionArea.classList.add('hidden');
      setTimeout(() => {
        // 隱藏覆蓋層
        loading.style.display = 'none';
        showResult();
      }, 600);
    }

    // 生成並下載結果卡片（改為異步，確保圖片載入完成）
    async function downloadCard() {
      // 取得結果頁圖像來源：優先使用結果頁已載入的圖片
      let imgSrc = '';
      const resultImgDOM = document.getElementById('result-image');
      if (resultImgDOM && resultImgDOM.src) {
        imgSrc = resultImgDOM.src;
      } else if (resultImages[mainType]) {
        imgSrc = resultImages[mainType];
      }
      // 載入圖片的輔助函式
      const loadImage = (src) => {
        return new Promise((resolve, reject) => {
          const image = new Image();
          /*
           * 若網站與圖片來源為同一網域（GitHub Pages 上均為同域），
           * 不必設定 crossOrigin 屬性，否則瀏覽器可能因 CORS 頭設定不符
           * 而將圖片標記為 tainted，導致 Canvas API 無法導出資料。
           */
          image.onload = () => resolve(image);
          image.onerror = reject;
          image.src = src;
        });
      };
      let loadedImg = null;
      if (imgSrc) {
        try {
          loadedImg = await loadImage(imgSrc);
        } catch (_) {
          loadedImg = null;
        }
      }
      // 建立畫布並加大高度以容納更多段落
      const canvas = document.createElement('canvas');
      const width = 820;
      const height = 820;
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      // 讀取樣式顏色
      const rootStyles = getComputedStyle(document.documentElement);
      const primary = rootStyles.getPropertyValue('--primary-color');
      const primaryDark = rootStyles.getPropertyValue('--primary-dark');
      const accent = rootStyles.getPropertyValue('--accent-color');
      const textColor = rootStyles.getPropertyValue('--text-color');
      // 背景填充
      ctx.fillStyle = primary.trim();
      ctx.fillRect(0, 0, width, height);
      // 白色卡片區域
      const margin = 40;
      const cardW = width - margin * 2;
      const cardH = height - margin * 2;
      const radius = 16;
      ctx.fillStyle = '#ffffff';
      ctx.beginPath();
      ctx.moveTo(margin + radius, margin);
      ctx.lineTo(margin + cardW - radius, margin);
      ctx.quadraticCurveTo(margin + cardW, margin, margin + cardW, margin + radius);
      ctx.lineTo(margin + cardW, margin + cardH - radius);
      ctx.quadraticCurveTo(margin + cardW, margin + cardH, margin + cardW - radius, margin + cardH);
      ctx.lineTo(margin + radius, margin + cardH);
      ctx.quadraticCurveTo(margin, margin + cardH, margin, margin + cardH - radius);
      ctx.lineTo(margin, margin + radius);
      ctx.quadraticCurveTo(margin, margin, margin + radius, margin);
      ctx.closePath();
      ctx.fill();
      // 橫條點綴
      const barHeight = 10;
      // 對於 B 型使用較淡的顏色，避免過於搶眼
      ctx.fillStyle = (mainType === 'B') ? 'rgba(239,169,59,0.3)' : accent.trim();
      ctx.fillRect(margin, margin, cardW, barHeight);
      const centerX = margin + cardW / 2;
      // 標題
      ctx.textAlign = 'center';
      ctx.fillStyle = primaryDark.trim();
      ctx.font = 'bold 28px sans-serif';
      ctx.fillText('卡關檢測專屬報告', centerX, margin + 42);
      // 主類型框
      const typeText = mainResults[mainType].title;
      ctx.font = 'bold 36px sans-serif';
      const typePaddingH = 14;
      const typeTextWidth = ctx.measureText(typeText).width;
      const typeRectW = typeTextWidth + typePaddingH * 2;
      const typeRectH = 46;
      const typeRectX = centerX - typeRectW / 2;
      const typeRectY = margin + 60;
      // 如果是 B 型，使用稍淡的矩形底色
      ctx.fillStyle = (mainType === 'B') ? 'rgba(239,169,59,0.6)' : accent.trim();
      ctx.fillRect(typeRectX, typeRectY, typeRectW, typeRectH);
      ctx.fillStyle = primaryDark.trim();
      ctx.textBaseline = 'middle';
      ctx.fillText(typeText, centerX, typeRectY + typeRectH / 2);
      // 繪製圖片：保持比例
      let imageDrawnHeight = 0;
      if (loadedImg) {
        const maxImgW = cardW - 160;
        const maxImgH = 240;
        const imgRatio = loadedImg.width / loadedImg.height;
        let drawW = maxImgW;
        let drawH = drawW / imgRatio;
        if (drawH > maxImgH) {
          drawH = maxImgH;
          drawW = drawH * imgRatio;
        }
        const imgX = centerX - drawW / 2;
        const imgY = typeRectY + typeRectH + 20;
        ctx.drawImage(loadedImg, imgX, imgY, drawW, drawH);
        imageDrawnHeight = drawH;
      }
      // 文字內容準備
      const description = mainResults[mainType].description || '';
      const analysis = document.getElementById('result-analysis').textContent || '';
      const reassure = document.getElementById('result-reassure').textContent || '';
      const splitSentences = (str) => {
        if (!str) return [];
        return str.split('。').map(s => s.trim()).filter(s => s.length > 0).map(s => s + '。');
      };
      const descSentences = splitSentences(description);
      const analysisSentences = splitSentences(analysis);
      const reassureSentences = splitSentences(reassure);
      // 文字樣式
      ctx.textAlign = 'left';
      ctx.fillStyle = textColor.trim();
      const textMaxW = cardW - 160;
      // 起始y
      let yPos = (typeRectY + typeRectH + 20) + imageDrawnHeight + 30;
      const sectionGap = 20;
      // Section Helper
      function drawSection(title, sentences) {
        ctx.font = 'bold 20px sans-serif';
        ctx.fillStyle = primaryDark.trim();
        ctx.fillText(title, margin + 80, yPos);
        yPos += 26;
        ctx.font = '18px sans-serif';
        ctx.fillStyle = textColor.trim();
        sentences.forEach((sent, idx) => {
          if (title === '概述' && idx === 0) {
            const lines = wrapText(ctx, sent, textMaxW);
            let highlightW = 0;
            lines.forEach(l => {
              const w = ctx.measureText(l).width;
              if (w > highlightW) highlightW = w;
            });
            const padX = 8;
            const highlightH = 26;
            // 亮句背景：根據類型選擇透明度
            const hlColor = (mainType === 'B') ? 'rgba(239,169,59,0.06)' : 'rgba(239,169,59,0.08)';
            ctx.fillStyle = hlColor;
            ctx.fillRect(margin + 80, yPos - 18, highlightW + padX * 2, highlightH);
            ctx.fillStyle = textColor.trim();
            lines.forEach(l => {
              ctx.fillText(l, margin + 80 + padX, yPos);
              yPos += 24;
            });
          } else {
            const lines = wrapText(ctx, sent, textMaxW);
            lines.forEach(l => {
              ctx.fillText(l, margin + 80, yPos);
              yPos += 24;
            });
          }
        });
        yPos += sectionGap;
      }
      // 繪製各區塊
      if (descSentences.length > 0) {
        drawSection('概述', descSentences);
      }
      if (analysisSentences.length > 0) {
        drawSection('心理分析', analysisSentences);
      }
      if (reassureSentences.length > 0) {
        drawSection('建議', reassureSentences);
      }
      // 下載圖檔
      /*
       * 使用 canvas.toBlob() 搭配 URL.createObjectURL 來產生可下載連結。
       * 這種方式比直接使用 toDataURL 更穩定，且避免長度過長的 base64 資料。
       */
      canvas.toBlob((blob) => {
        const blobUrl = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.download = 'result_card.png';
        link.href = blobUrl;
        link.style.display = 'none';
        // 在某些瀏覽器（例如 GitHub Pages 下）直接下載可能會被攔截，設置 target='_blank' 可確保能開啟新標籤讓使用者另存
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        // 不立即 revoke，讓新標籤頁能完整載入
        setTimeout(() => {
          URL.revokeObjectURL(blobUrl);
        }, 1000);
      }, 'image/png');
    }

    // 文字換行輔助函式
    function wrapText(ctx, text, maxWidth) {
      const words = text.split(/\s+/);
      const lines = [];
      let currentLine = '';
      words.forEach((word) => {
        const testLine = currentLine + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && currentLine !== '') {
          lines.push(currentLine.trim());
          currentLine = word + ' ';
        } else {
          currentLine = testLine;
        }
      });
      if (currentLine.trim() !== '') {
        lines.push(currentLine.trim());
      }
      return lines;
    }

    // 動態生成進度點：根據題目數量建立小圓點
    function createProgressDots() {
      if (!progressDots) return;
      progressDots.innerHTML = '';
      for (let i = 0; i < totalSteps; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot';
        progressDots.appendChild(dot);
      }
      updateProgressDots();
    }

    // 更新進度點：將當前題目標記為 active
    function updateProgressDots() {
      if (!progressDots) return;
      const dots = progressDots.querySelectorAll('.dot');
      dots.forEach((dot, index) => {
        // 使用 stepCounter-1 表示已答題目索引（從 0 開始）
        dot.classList.toggle('active', index === stepCounter - 1);
      });
    }

    // 更新進度條寬度
    function updateProgress() {
      if (totalSteps > 0) {
        const percent = (stepCounter / totalSteps) * 100;
        progressInner.style.width = percent + '%';
        // 更新進度標籤顯示：第 X 題 / 共 Y 題
        if (progressLabel) {
          progressLabel.textContent = `第 ${stepCounter} 題 / 共 ${totalSteps} 題`;
        }
        // 更新進度點樣式
        updateProgressDots();
      } else {
        progressInner.style.width = '0%';
        if (progressLabel) {
          progressLabel.textContent = '';
        }
      }
    }

    // 綁定下載按鈕事件
    downloadBtn.addEventListener('click', downloadCard);
  </script>
</body>
</html>